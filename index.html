<script>
let cropper;
function triggerImageUpload() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function captureFromCamera() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.capture = 'environment';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function showOptionModal(file) {
  window.selectedImageFile = file;
  document.getElementById("optionModal").classList.remove("hidden");
}
function closeOptionModal() {
  document.getElementById("optionModal").classList.add("hidden");
}
function chooseAnalyze(mode) {
  closeOptionModal();
  if (mode === 'full') {
    readImageText(window.selectedImageFile);
  } else {
    initCropper(window.selectedImageFile);
  }
}
function initCropper(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = document.createElement('img');
    img.src = e.target.result;
    img.id = 'cropImage';
    img.classList.add("max-h-96", "mx-auto", "my-4", "rounded-xl", "shadow");

    const container = document.createElement('div');
    container.id = 'cropContainer';
    container.appendChild(img);
    const analyzeBtn = document.createElement('button');
    analyzeBtn.textContent = "تحليل النص المقصود";
    analyzeBtn.className = "block mx-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl mb-4";
    analyzeBtn.onclick = () => {
      const canvas = cropper.getCroppedCanvas();
      canvas.toBlob(blob => {
        readImageText(blob);
        container.remove();
        cropper.destroy();
      });
    };
    container.appendChild(analyzeBtn);
    document.getElementById("mainApp").appendChild(container);

    cropper = new Cropper(img, {
      viewMode: 1,
      autoCropArea: 1,
      movable: true,
      zoomable: true,
      background: false,
    });
  };
  reader.readAsDataURL(file);
}
function readImageText(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      simulateOCR(canvas);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
function simulateOCR(canvas) {
  const ctx = canvas.getContext('2d');
  const text = ctx.getImageData(0, 0, canvas.width, canvas.height) ? "صورة مقروءة بنجاح (تجريبياً)" : "لم يتم التعرف على نص";
  showCountdown(() => {
    document.getElementById("inputText").value = text;
    analyze();
  });
}
function showCountdown(callback) {
  const overlay = document.getElementById("countdownOverlay");
  overlay.style.display = "flex";
  let count = 4;
  overlay.textContent = count;
  const interval = setInterval(() => {
    count--;
    overlay.textContent = count;
    if (count === 0) {
      clearInterval(interval);
      overlay.style.display = "none";
      callback();
    }
  }, 500);
}
</script><div class="text-center text-sm text-gray-600 mt-16 mb-4 leading-relaxed">
  <p class="text-green-700 font-semibold">﴿ وَقُل رَّبِّ زِدْنِي عِلْمًا ﴾</p>
  <p>تم بحمد الله وتوفيقه</p>
  <p>بإشراف: <strong>عبدالرحمن عمرو</strong></p>
  <p>تطوير: <strong>حسن علي</strong></p>
</div></body>
</html>
<script>
let cropper;
function triggerImageUpload() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function captureFromCamera() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.capture = 'environment';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function showOptionModal(file) {
  window.selectedImageFile = file;
  document.getElementById("optionModal").classList.remove("hidden");
}
function closeOptionModal() {
  document.getElementById("optionModal").classList.add("hidden");
}
function chooseAnalyze(mode) {
  closeOptionModal();
  if (mode === 'full') {
    readImageText(window.selectedImageFile);
  } else {
    initCropper(window.selectedImageFile);
  }
}
function initCropper(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = document.createElement('img');
    img.src = e.target.result;
    img.id = 'cropImage';
    img.classList.add("max-h-96", "mx-auto", "my-4", "rounded-xl", "shadow");

    const container = document.createElement('div');
    container.id = 'cropContainer';
    container.appendChild(img);
    const analyzeBtn = document.createElement('button');
    analyzeBtn.textContent = "تحليل النص المقصود";
    analyzeBtn.className = "block mx-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl mb-4";
    analyzeBtn.onclick = () => {
      const canvas = cropper.getCroppedCanvas();
      canvas.toBlob(blob => {
        readImageText(blob);
        container.remove();
        cropper.destroy();
      });
    };
    container.appendChild(analyzeBtn);
    document.getElementById("mainApp").appendChild(container);

    cropper = new Cropper(img, {
      viewMode: 1,
      autoCropArea: 1,
      movable: true,
      zoomable: true,
      background: false,
    });
  };
  reader.readAsDataURL(file);
}
function readImageText(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      simulateOCR(canvas);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
function simulateOCR(canvas) {
  const ctx = canvas.getContext('2d');
  const text = ctx.getImageData(0, 0, canvas.width, canvas.height) ? "صورة مقروءة بنجاح (تجريبياً)" : "لم يتم التعرف على نص";
  showCountdown(() => {
    document.getElementById("inputText").value = text;
    analyze();
  });
}
function showCountdown(callback) {
  const overlay = document.getElementById("countdownOverlay");
  overlay.style.display = "flex";
  let count = 4;
  overlay.textContent = count;
  const interval = setInterval(() => {
    count--;
    overlay.textContent = count;
    if (count === 0) {
      clearInterval(interval);
      overlay.style.display = "none";
      callback();
    }
  }, 500);
}
</script><div class="text-center text-sm text-gray-600 mt-16 mb-4 leading-relaxed">
  <p class="text-green-700 font-semibold">﴿ وَقُل رَّبِّ زِدْنِي عِلْمًا ﴾</p>
  <p>تم بحمد الله وتوفيقه</p>
  <p>بإشراف: <strong>عبدالرحمن عمرو</strong></p>
  <p>تطوير: <strong>حسن علي</strong></p>
</div></body>
</html>
<script>
let cropper;
function triggerImageUpload() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function captureFromCamera() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.capture = 'environment';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function showOptionModal(file) {
  window.selectedImageFile = file;
  document.getElementById("optionModal").classList.remove("hidden");
}
function closeOptionModal() {
  document.getElementById("optionModal").classList.add("hidden");
}
function chooseAnalyze(mode) {
  closeOptionModal();
  if (mode === 'full') {
    readImageText(window.selectedImageFile);
  } else {
    initCropper(window.selectedImageFile);
  }
}
function initCropper(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = document.createElement('img');
    img.src = e.target.result;
    img.id = 'cropImage';
    img.classList.add("max-h-96", "mx-auto", "my-4", "rounded-xl", "shadow");

    const container = document.createElement('div');
    container.id = 'cropContainer';
    container.appendChild(img);
    const analyzeBtn = document.createElement('button');
    analyzeBtn.textContent = "تحليل النص المقصود";
    analyzeBtn.className = "block mx-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl mb-4";
    analyzeBtn.onclick = () => {
      const canvas = cropper.getCroppedCanvas();
      canvas.toBlob(blob => {
        readImageText(blob);
        container.remove();
        cropper.destroy();
      });
    };
    container.appendChild(analyzeBtn);
    document.getElementById("mainApp").appendChild(container);

    cropper = new Cropper(img, {
      viewMode: 1,
      autoCropArea: 1,
      movable: true,
      zoomable: true,
      background: false,
    });
  };
  reader.readAsDataURL(file);
}
function readImageText(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      simulateOCR(canvas);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
function simulateOCR(canvas) {
  const ctx = canvas.getContext('2d');
  const text = ctx.getImageData(0, 0, canvas.width, canvas.height) ? "صورة مقروءة بنجاح (تجريبياً)" : "لم يتم التعرف على نص";
  showCountdown(() => {
    document.getElementById("inputText").value = text;
    analyze();
  });
}
function showCountdown(callback) {
  const overlay = document.getElementById("countdownOverlay");
  overlay.style.display = "flex";
  let count = 4;
  overlay.textContent = count;
  const interval = setInterval(() => {
    count--;
    overlay.textContent = count;
    if (count === 0) {
      clearInterval(interval);
      overlay.style.display = "none";
      callback();
    }
  }, 500);
}
</script><div class="text-center text-sm text-gray-600 mt-16 mb-4 leading-relaxed">
  <p class="text-green-700 font-semibold">﴿ وَقُل رَّبِّ زِدْنِي عِلْمًا ﴾</p>
  <p>تم بحمد الله وتوفيقه</p>
  <p>بإشراف: <strong>عبدالرحمن عمرو</strong></p>
  <p>تطوير: <strong>حسن علي</strong></p>
</div></body>
</html>
<script>
let cropper;
function triggerImageUpload() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function captureFromCamera() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.capture = 'environment';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      showOptionModal(file);
    }
  };
  input.click();
}
function showOptionModal(file) {
  window.selectedImageFile = file;
  document.getElementById("optionModal").classList.remove("hidden");
}
function closeOptionModal() {
  document.getElementById("optionModal").classList.add("hidden");
}
function chooseAnalyze(mode) {
  closeOptionModal();
  if (mode === 'full') {
    readImageText(window.selectedImageFile);
  } else {
    initCropper(window.selectedImageFile);
  }
}
function initCropper(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = document.createElement('img');
    img.src = e.target.result;
    img.id = 'cropImage';
    img.classList.add("max-h-96", "mx-auto", "my-4", "rounded-xl", "shadow");

    const container = document.createElement('div');
    container.id = 'cropContainer';
    container.appendChild(img);
    const analyzeBtn = document.createElement('button');
    analyzeBtn.textContent = "تحليل النص المقصود";
    analyzeBtn.className = "block mx-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl mb-4";
    analyzeBtn.onclick = () => {
      const canvas = cropper.getCroppedCanvas();
      canvas.toBlob(blob => {
        readImageText(blob);
        container.remove();
        cropper.destroy();
      });
    };
    container.appendChild(analyzeBtn);
    document.getElementById("mainApp").appendChild(container);

    cropper = new Cropper(img, {
      viewMode: 1,
      autoCropArea: 1,
      movable: true,
      zoomable: true,
      background: false,
    });
  };
  reader.readAsDataURL(file);
}
function readImageText(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      simulateOCR(canvas);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
function simulateOCR(canvas) {
  const ctx = canvas.getContext('2d');
  const text = ctx.getImageData(0, 0, canvas.width, canvas.height) ? "صورة مقروءة بنجاح (تجريبياً)" : "لم يتم التعرف على نص";
  showCountdown(() => {
    document.getElementById("inputText").value = text;
    analyze();
  });
}
function showCountdown(callback) {
  const overlay = document.getElementById("countdownOverlay");
  overlay.style.display = "flex";
  let count = 4;
  overlay.textContent = count;
  const interval = setInterval(() => {
    count--;
    overlay.textContent = count;
    if (count === 0) {
      clearInterval(interval);
      overlay.style.display = "none";
      callback();
    }
  }, 500);
}
</script><div class="text-center text-sm text-gray-600 mt-16 mb-4 leading-relaxed">
  <p class="text-green-700 font-semibold">﴿ وَقُل رَّبِّ زِدْنِي عِلْمًا ﴾</p>
  <p>تم بحمد الله وتوفيقه</p>
  <p>بإشراف: <strong>عبدالرحمن عمرو</strong></p>
  <p>تطوير: <strong>حسن علي</strong></p>
</div></body>
</html>
